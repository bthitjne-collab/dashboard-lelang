import os
import sqlite3
import pandas as pd

DB_PATH = "lelang.db"

# Jika database belum ada atau rusak, buat ulang
if not os.path.exists(DB_PATH) or os.path.getsize(DB_PATH) < 100:
    conn = sqlite3.connect(DB_PATH)
    conn.execute("""
    CREATE TABLE barang (
        id_barang INTEGER PRIMARY KEY AUTOINCREMENT,
        nama_barang TEXT,
        kategori TEXT,
        harga_awal INTEGER,
        status TEXT
    )
    """)
    conn.execute("""
    CREATE TABLE penjualan (
        id_penjualan INTEGER PRIMARY KEY AUTOINCREMENT,
        id_barang INTEGER,
        tanggal DATE,
        harga_terjual INTEGER,
        pembeli TEXT
    )
    """)
    # Tambahkan data contoh
    barang_data = [
        ("Laptop ASUS", "Elektronik", 3500000, "Terjual"),
        ("Kamera Canon", "Elektronik", 2500000, "Dilelang"),
        ("Sepeda Gunung", "Olahraga", 1800000, "Terjual"),
    ]
    penjualan_data = [
        (1, "2025-01-10", 4000000, "Andi"),
        (3, "2025-02-05", 2100000, "Budi"),
    ]
    conn.executemany("INSERT INTO barang (nama_barang, kategori, harga_awal, status) VALUES (?, ?, ?, ?)", barang_data)
    conn.executemany("INSERT INTO penjualan (id_barang, tanggal, harga_terjual, pembeli) VALUES (?, ?, ?, ?)", penjualan_data)
    conn.commit()
else:
    conn = sqlite3.connect(DB_PATH)
